# DockerでたてたWebサーバーのHTTPS対応を考えた話
DockerでWebサーバをたてたのですが、コンテナでHTTPS対応どうするんだろうと考えたはなしです。  

## コンテナ内で証明書発行は少々めんどい
コンテナやってるんではじめはWebサーバコンテナ内で証明書発行しようとしますよね。コンテナのビルドにcertbotコマンドを仕込むとか。  
ただこれコンテナをビルドする度に証明書発行しちゃいますね。なので開発時とリリース時でビルドのやりかたを変えたくなるんですけど、HTTPS対応のためにコンテナ構成が複雑になるのもなんかもやもやします。  

## 証明書発行はホストでやっとく
なので発行はホスト側でやることにしました。ホストでcertbot叩いて、証明書のディレクトリをコンテナにマウントします。  
CAとの認証仕様をあまり理解しておらず、Webサーバ本体であるコンテナで発行しなくてもいいのかわかってないまま試したのですが、どうやら大丈夫みたいです。  

## ホストとコンテナのバランス
ホストで作業することになるので、当然新しいサーバでのビルドはDockerだけでは済まなくなります。  
まあ私なりの妥協点です。ビルド作業の多さと構成の複雑さでバランスをとった感じです。  

## そもそもマネージドサービスが最も楽
たぶんコンテナのマネージドサービスを利用すれば自分でHTTPS化を対応する必要ないんでしょうね。Cloud Runとか、たぶん。  
世の中進みますなあ。  
